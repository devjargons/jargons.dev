---
import { Image } from "astro:assets";
import doAuth from "../../lib/actions/do-auth.js";
import BaseLayout from "../../layouts/base.astro";

const { url: { pathname }, redirect } = Astro;

const { isAuthed, authedData: userData } = await doAuth(Astro);
if (!isAuthed) return redirect(`/login?return_to=${encodeURIComponent(pathname)}`);
---

<BaseLayout 
  pageTitle="Dictionry"
  class="flex flex-col w-full min-h-screen"
>
  <main class="flex flex-col grow px-5 md:px-6 pb-4 space-y-3">
    <!-- Profile Section -->
    <section class="mt-10 flex w-full items-center justify-between md:px-6">
      <div class="flex flex-col space-y-6 justify-center h-full py-6">
        <span class="relative flex shrink-0 overflow-hidden rounded-full w-20 h-20 border">
          <!-- src="https://images.unsplash.com/profile-1606728664311-4bcc76a40e98image?bg=fff&crop=faces&dpr=2&h=150&w=150&auto=format&fit=crop&q=60&ixlib=rb-4.0.3"  -->
          <Image 
            src={ userData.avatar_url }
            alt={ (userData.name || userData.login) ?? "User avatar" }
            width={100}
            height={100} 
            loading="eager"
          />
        </span>
        <div class="space-y-2">
          <h3 class="text-2xl tracking-tight font-semibold">Hey, { userData.login }ðŸ‘‹</h3>
          <p class="text-base text-gray-500">Welcome to the Jargons Editor, we're super excited to see you here.</p>
        </div>  
      </div>
    </section>

    <!-- Contribution CTA -->
    <section class="rounded-lg border shadow-sm">
      <div class="space-y-1.5 p-3 md:p-6 flex flex-col lg:flex-row lg:items-center justify-between gap-4">
        <div class="space-y-1">
          <h3 class="font-semibold tracking-tight text-2xl">Contribute Words</h3>
          <p class="text-sm">
            You can contribute new words to the dictionary. They will be reviewed by our <em>jargonists</em> and added in no time.
          </p>
        </div>
        <a
          class="flex items-center w-fit justify-center no-underline px-4 py-2 rounded-md border border-gray-200 bg-white hover:bg-gray-100 text-sm shadow-sm hover:shadow transition-colors"
          href="/editor/new"
        >
          <span>Start Now</span>
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width={1.5} stroke="currentColor" class="w-4 h-4">
            <path stroke-linecap="round" stroke-linejoin="round" d="m4.5 19.5 15-15m0 0H8.25m11.25 0v11.25" />
          </svg> 
        </a>
      </div>
    </section>
  </main>
</BaseLayout>
